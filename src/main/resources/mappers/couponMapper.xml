<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.icia.wapoo.dao.CouponDao">
	

    <insert id="insertCoupon" useGeneratedKeys="true" keyColumn="couponId" keyProperty="couponId" parameterType="Coupon">
        INSERT INTO `coupon`
        SET
        `couponNumber` = #{couponNumber},
        `couponName` = #{couponName},
        `couponEnd` = #{couponEnd},
        status = 'Y',
        `couponPrice` = #{couponPrice},
        `discountRate` = #{discountRate},
        publishedDate = NOW(),
        food_id = null,
        event_id = null
    </insert>

	<resultMap id="couponResultMap" type="java.util.Map">
        <result column="countNumber" property="countNumber"/>
        <result column="couponName" property="couponName"/>
        <result column="couponEnd" property="couponEnd"/>
        <result column="status" property="status"/>
        <result column="couponPrice" property="couponPrice"/>
        <result column="discountRate" property="discountRate" />
        <result column="publishedDate" property="publishedDate" />
    </resultMap>
	<select id="selectCouponList" resultMap="couponResultMap">
        SELECT
        	couponId,
            couponNumber,
            couponName,
            couponEnd,
            status,
            couponPrice,
            discountRate,
            publishedDate
        FROM coupon
        <if test="!option.equals('ALL')">
        WHERE 
            status = #{option}
        </if>
    </select>
    
    <select id="selectCouponListCount" resultType="int">
        SELECT COUNT(*) AS result
        FROM coupon
        <if test="!option.equals('ALL')">
            WHERE status = #{option}
        </if>
    </select>
    
    <update id="updateCouponStatus" parameterType="Coupon">
        UPDATE coupon
		SET STATUS = #{status}
		WHERE couponId = #{couponId}

    </update>
</mapper>